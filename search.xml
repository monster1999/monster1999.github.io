<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>nginx配置ssl证书实现https</title>
    <url>/archives/d3850c25.html</url>
    <content><![CDATA[<h3 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h3><p>服务器系统：Ubuntu16.04（其他系统或有不同，请自行搜索）</p>
<p>主机商：阿里云</p>
<hr>
<h3 id="ssl证书申请："><a href="#ssl证书申请：" class="headerlink" title="ssl证书申请："></a>ssl证书申请：</h3><p>在阿里云域名管理控制台–基本信息–ssl证书–开启ssl证书处购买免费ssl证书。在云盾证书服务(包年)处选择免费版（个人）DV免费：</p>
<p><img src="D:%5CUsers%5C%E6%AE%B5%E5%90%AF%E9%98%B3%5CDesktop%5Cblog%5Cmyblog%5Csource_posts%5Cnginx%E9%85%8D%E7%BD%AEssl%E8%AF%81%E4%B9%A6%E5%AE%9E%E7%8E%B0https%5C1.png" alt>购买一年ssl证书（证书过期后再次购买即可，配置过程是一样的）。购买成功后回到管理页面，点击“补全”，输入你的域名，点下一步，待几分钟，证书状态变为“已签发”后，证书就申请成功了。</p>
<p>说明：因为我们这里申请的是开发版免费证书，所以一个证书仅支持一个域名认证，不支持通配符。</p>
<hr>
<h3 id="下载证书"><a href="#下载证书" class="headerlink" title="下载证书"></a>下载证书</h3><p>列表中找到已签发的证书，进入下载页面，找到nginx信息，并点击下载：</p>
<p><img src="D:%5CUsers%5C%E6%AE%B5%E5%90%AF%E9%98%B3%5CDesktop%5Cblog%5Cmyblog%5Csource_posts%5Cnginx%E9%85%8D%E7%BD%AEssl%E8%AF%81%E4%B9%A6%E5%AE%9E%E7%8E%B0https%5C2.png" alt></p>
<p>下载的文件有两个：</p>
<p><em>domain name.pem</em>和<em>domain name.key</em>（domain name为你证书名称）</p>
<hr>
<h3 id="服务器安装并配置nginx"><a href="#服务器安装并配置nginx" class="headerlink" title="服务器安装并配置nginx"></a>服务器安装并配置nginx</h3><p>登录到服务器：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">$ apt-<span class="built_in">get</span> update <span class="comment">// 更新软件</span></span><br><span class="line">$ apt-<span class="built_in">get</span> install nginx <span class="comment">// 安装nginx</span></span><br></pre></td></tr></table></figure>

<p>若输入 <code>nginx -V</code> 可以看到 nginx 版本信息，则安装成功。</p>
<hr>
<h3 id="配置ssl证书"><a href="#配置ssl证书" class="headerlink" title="配置ssl证书"></a>配置ssl证书</h3><p>1，nginx的安装目录为：/etc/nginx/。进入目录，增加cert/文件夹，把刚刚下载的两个文件上传到cert/文件夹中。</p>
<p>2，在/etc/nginx/sites-enabled/下，增加monsterd.cn(此为你的域名)文件。内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name monsterd.cn; &#x2F;&#x2F;你的域名</span><br><span class="line">    root &#x2F;var&#x2F;www&#x2F;blog; &#x2F;&#x2F; 网站根目录</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    ssl_certificate  cert&#x2F;domain name.pem;&#x2F;&#x2F; 将domain name改成你证书的名字</span><br><span class="line">    ssl_certificate_key cert&#x2F;domain name.key;&#x2F;&#x2F; 将domain name改成你证书的名字</span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name monsterd.cn;  &#x2F;&#x2F; 你的域名</span><br><span class="line">    rewrite ^(.*)$ https:&#x2F;&#x2F;$host$1 permanent; &#x2F;&#x2F; 把http的域名请求转成https</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置完成后，检查一下nginx配置文件是否可用，有successful表示可用。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">$ nginx -t <span class="comment">// 检查nginx配置文件</span></span><br></pre></td></tr></table></figure>

<p>配置正确后，重新加载配置文件使配置生效：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">$ nginx -s reload <span class="comment">// 使配置生效</span></span><br></pre></td></tr></table></figure>

<p>至此，nginx的https访问就完成了，并且通过rewrite方式把所有http请求也转成了https请求，更加安全。</p>
<p>如需重启nginx，用以下命令：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">$ service nginx <span class="built_in">stop</span> <span class="comment">// 停止</span></span><br><span class="line">$ service nginx start <span class="comment">// 启动</span></span><br><span class="line">$ service nginx restart <span class="comment">// 重启</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p>输入<a href="http://monsterd.cn">http://monsterd.cn</a>  也会自动跳转至https页面。</p>
<p>说明：云服务器比如阿里云ECS，需要到阿里云ECS的管理后台的安全组，修改端口过滤规则把80端口和443端口开放才能访问到。</p>
<p>至此，就能实现https。</p>
<hr>
]]></content>
      <categories>
        <category>建站相关</category>
      </categories>
      <tags>
        <tag>https</tag>
      </tags>
  </entry>
</search>
